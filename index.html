<!doctype html>
<html lang="de" data-ui-theme="light" data-ui-density="comfortable">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UI Kit 0 – Max Feature Demo</title>

  <!-- Theme / Design API (tokens + theme/density switching) -->
  <link rel="stylesheet" href="./src/ui-kit-0.theme.css" />

  <!-- Component styles (consumes tokens) -->
  <link rel="stylesheet" href="./src/ui-kit-0.css" />

  <style>
    .app { max-width: 1280px; margin: 0 auto; padding: 12px; }
    .hint { font-size: 12px; opacity: 0.8; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid rgba(0,0,0,0.15); border-radius:999px; font-size:12px; }
    .kpi { display:flex; gap:10px; flex-wrap:wrap; align-items: center; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .warn { color: #b45309; }
  </style>

  <!-- =========================
       third_party (offline)
       ========================= -->

  <!-- AJV Draft-07 bundle (sets window.ajv7) -->
  <script src="./src/third_party/ajv/ajv7.bundle.min.js"></script>

  <!-- Ace (sets window.ace) -->
  <script src="./src/third_party/ace/ace.js"></script>
  <script src="./src/third_party/ace/mode-json.js"></script>
  <script src="./src/third_party/ace/worker-json.js"></script>

  <!-- json-editor (sets window.JSONEditor) -->
  <script src="./src/third_party/json-editor/jsoneditor.min.js"></script>

  <!-- Chart.js (sets window.Chart) -->
  <script src="./src/third_party/chartjs/chart.umd.min.js"></script>
</head>

<body>
  <div id="app"></div>
<script>
  // Visible error overlay (no console needed)
  window.addEventListener("error", (e) => {
    const pre = document.createElement("pre");
    pre.style.whiteSpace = "pre-wrap";
    pre.style.padding = "12px";
    pre.style.margin = "12px";
    pre.style.border = "2px solid #b00020";
    pre.style.background = "#fdecea";
    pre.textContent =
      "JS ERROR:\n" +
      (e?.message || e) + "\n\n" +
      (e?.filename ? `${e.filename}:${e.lineno}:${e.colno}\n\n` : "") +
      (e?.error?.stack || "");
    document.body.prepend(pre);
  });

  window.addEventListener("unhandledrejection", (e) => {
    const pre = document.createElement("pre");
    pre.style.whiteSpace = "pre-wrap";
    pre.style.padding = "12px";
    pre.style.margin = "12px";
    pre.style.border = "2px solid #b00020";
    pre.style.background = "#fdecea";
    pre.textContent =
      "PROMISE REJECTION:\n" +
      (e?.reason?.message || String(e?.reason || e)) + "\n\n" +
      (e?.reason?.stack || "");
    document.body.prepend(pre);
  });
</script>
  <script type="module">
    import * as UI from "./src/ui-kit-0.js";

    // -----------------------
    // Theme/Density helpers (demo only)
    // -----------------------
    function setTheme(theme) {
      // "light" | "dark" | "auto"
      document.documentElement.dataset.uiTheme = theme;
    }
    function setDensity(density) {
      // "comfortable" | "compact"
      document.documentElement.dataset.uiDensity = density;
    }

    // -----------------------
    // Quick runtime checks
    // -----------------------
    const globals = {
      ajv7: typeof window.ajv7 !== "undefined",
      ace: typeof window.ace !== "undefined",
      JSONEditor: typeof window.JSONEditor !== "undefined",
      Chart: typeof window.Chart !== "undefined",
    };

    // -----------------------
    // Demo schemas (Draft-07)
    // -----------------------
    const draft07 = "http://json-schema.org/draft-07/schema#";

    const schemaV1 = {
      $schema: draft07,
      title: "Service Config (Demo)",
      type: "object",
      additionalProperties: false,
      required: ["kind", "backend", "observability"],
      properties: {
        kind: { type: "string", const: "service-config" },
        backend: {
          title: "Backend",
          oneOf: [
            {
              title: "HTTP Backend",
              type: "object",
              additionalProperties: false,
              required: ["type", "url", "timeoutMs"],
              properties: {
                type: { const: "http" },
                url: { type: "string", minLength: 1 },
                timeoutMs: { type: "integer", minimum: 50, maximum: 60000 },
                headers: { type: "object", additionalProperties: { type: "string" } }
              }
            },
            {
              title: "UNIX Socket Backend",
              type: "object",
              additionalProperties: false,
              required: ["type", "path"],
              properties: {
                type: { const: "unix" },
                path: { type: "string", minLength: 1 }
              }
            }
          ]
        },
        cache: {
          title: "Cache",
          type: "object",
          additionalProperties: false,
          properties: {
            enabled: { type: "boolean", default: false },
            maxItems: { type: "integer", minimum: 0, default: 500 },
            policy: { type: "string", enum: ["lru", "fifo", "none"], default: "lru" },
            constraints: {
              title: "Constraints (anyOf)",
              type: "object",
              additionalProperties: false,
              properties: {
                ttlSeconds: { type: "integer", minimum: 1, maximum: 86400 },
                maxBytes: { type: "integer", minimum: 1024 }
              },
              anyOf: [
                { required: ["ttlSeconds"] },
                { required: ["maxBytes"] }
              ]
            }
          }
        },
        features: {
          title: "Features",
          type: "object",
          additionalProperties: false,
          properties: {
            featureX: { type: "boolean", default: false },
            safeMode: { type: "boolean", default: true },
            mode: { type: "string", enum: ["dev", "prod", "test"], default: "dev" }
          }
        },
        observability: {
          title: "Observability",
          type: "object",
          additionalProperties: false,
          required: ["logLevel", "metrics"],
          properties: {
            logLevel: { type: "string", enum: ["debug", "info", "warn", "error"], default: "info" },
            metrics: {
              type: "object",
              additionalProperties: false,
              required: ["enabled", "sampleRate"],
              properties: {
                enabled: { type: "boolean", default: true },
                sampleRate: { type: "number", minimum: 0, maximum: 1, default: 1.0 }
              }
            }
          }
        },
        allowList: {
          title: "Allow List",
          type: "array",
          items: { type: "string", minLength: 1 },
          default: ["127.0.0.1", "10.0.0.0/8"]
        }
      }
    };

    const schemaV2 = JSON.parse(JSON.stringify(schemaV1));
    schemaV2.title = "Service Config (Demo, v2)";
    schemaV2.properties.features.properties.mode.enum = ["dev", "prod", "staging", "test"];
    schemaV2.properties.cache.properties.policy.enum = ["lru", "fifo", "lfu", "none"];

    // -----------------------
    // Store
    // -----------------------
    const store = new UI.Store({
      clicks: 0,
      name: "Alice",
      role: "dev",
      age: 31,
      agree: true,
      config: {
        zebra: true,
        themeDense: false, // kept for demo UI toggle; maps to density below
        theme: "light",    // "light" | "dark" | "auto"
      },

      people: [
        { id: 1, name: "Alice", age: 31, active: true },
        { id: 2, name: "Bob", age: 24, active: false },
        { id: 3, name: "Carla", age: 29, active: true },
      ],

      metrics: {
        countsByRole: { dev: 0, ops: 0, pm: 0, qa: 0 },
        samples: []
      },

      jsonSchema: schemaV1,
      jsonConfig: {
        kind: "service-config",
        backend: { type: "http", url: "http://localhost:8080/api", timeoutMs: 1500, headers: { "x-demo": "1" } },
        cache: { enabled: true, maxItems: 500, policy: "lru", constraints: { ttlSeconds: 60 } },
        features: { featureX: false, safeMode: true, mode: "dev" },
        observability: { logLevel: "info", metrics: { enabled: true, sampleRate: 1.0 } },
        allowList: ["127.0.0.1", "10.0.0.0/8"]
      }
    });

    // derived counts by role for charts
    function recomputeCountsByRole() {
      const people = store.get().people || [];
      const counts = { dev: 0, ops: 0, pm: 0, qa: 0 };
      for (const p of people) {
        const r =
          (p.age ?? 0) >= 40 ? "pm" :
          (p.age ?? 0) >= 30 ? "dev" :
          (p.age ?? 0) >= 25 ? "ops" : "qa";
        counts[r] = (counts[r] || 0) + 1;
      }
      store.setPath("metrics.countsByRole", counts);
    }
    recomputeCountsByRole();
    store.subscribePath("people", () => recomputeCountsByRole());

    // -----------------------
    // Root layout
    // -----------------------
    const app = new UI.VDiv({ gap: 12, className: "app" }).appendTo(document.getElementById("app"));

    const header = new UI.Card({ title: "" }).appendTo(app);
    new UI.Heading("UI Kit 0 – Max Feature Demo", { level: 2 }).appendTo(header);

    new UI.Text(
      `Version: ${UI.UI_KIT_VERSION} • Offline demo • Draft-07 AJV + Ace + json-editor + Chart.js`,
      { muted: true }
    ).appendTo(header);

    const deps = new UI.Text(
      `deps: ajv7=${globals.ajv7} ace=${globals.ace} JSONEditor=${globals.JSONEditor} Chart=${globals.Chart}`,
      { muted: true }
    ).appendTo(header);

    if (!globals.ajv7 || !globals.ace || !globals.JSONEditor || !globals.Chart) {
      deps.setText(`⚠ deps missing: ajv7=${globals.ajv7} ace=${globals.ace} JSONEditor=${globals.JSONEditor} Chart=${globals.Chart}`);
      deps.el.classList.add("warn");
    }

    const kpi = new UI.Div({ className: "kpi" }).appendTo(header);
    const pillClicks = document.createElement("span"); pillClicks.className = "pill mono";
    const pillPeople = document.createElement("span"); pillPeople.className = "pill mono";
    const pillRole = document.createElement("span"); pillRole.className = "pill mono";
    kpi.el.append(pillClicks, pillPeople, pillRole);

    function renderKpis() {
      const s = store.get();
      pillClicks.textContent = `clicks=${s.clicks}`;
      pillPeople.textContent = `people=${(s.people || []).length}`;
      pillRole.textContent = `role=${s.role}`;
    }
    renderKpis();
    store.subscribe(() => renderKpis());

    // -----------------------
    // Main surface + Tabs
    // -----------------------
    const surface = new UI.Card({ title: "" }).appendTo(app);
    const tabs = new UI.Tabs({ active: "controls" }).appendTo(surface);

    // -----------------------
    // TAB: Controls + Store binding
    // -----------------------
    tabs.addTab("controls", "Controls", () => {
      const root = new UI.VDiv({ gap: 12 });

      const row = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(root);

      const left = new UI.Card({ title: "Form + Actions" })
        .appendTo(row)
        .setStyle({ flex: "1 1 360px", minWidth: "300px" });

      const right = new UI.Card({ title: "Live state (JSON)" })
        .appendTo(row)
        .setStyle({ flex: "1 1 360px", minWidth: "300px" });

      // Actions
      const btnRow = new UI.HDiv({ gap: 8, wrap: true }).appendTo(left);
      new UI.Button("Click +1").appendTo(btnRow).onClick(() => store.setPath("clicks", (store.get().clicks || 0) + 1));
      new UI.Button("Reset clicks", { variant: "secondary" }).appendTo(btnRow).onClick(() => store.setPath("clicks", 0));
      new UI.Button("Danger (alert)", { variant: "danger" }).appendTo(btnRow).onClick(() => alert("Danger button demo"));

      // Theme/Density toggles (new contracts)
      const uiRow = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(left).setStyle({ marginTop: "10px" });

      new UI.Text("Theme", { muted: true }).appendTo(uiRow);
      new UI.Select({
        options: [
          { value: "light", label: "Light" },
          { value: "dark",  label: "Dark" },
          { value: "auto",  label: "Auto (system)" },
        ],
        placeholder: "Select…",
        parse: (s) => s,
        format: (v) => v ?? "light",
      }).appendTo(uiRow).on("change", (e) => {
        const v = e.target.value;
        setTheme(v);
        store.setPath("config.theme", v);
      }).setValue(store.get().config?.theme ?? "light");

      new UI.Text("Density", { muted: true }).appendTo(uiRow);
      new UI.Select({
        options: [
          { value: "comfortable", label: "Comfortable" },
          { value: "compact",     label: "Compact" },
        ],
        placeholder: "Select…",
        parse: (s) => s,
        format: (v) => v ?? "comfortable",
      }).appendTo(uiRow).on("change", (e) => {
        const v = e.target.value;
        setDensity(v);
      }).setValue(document.documentElement.dataset.uiDensity || "comfortable");

      // Form grid (same as before)
      const grid = new UI.Div({
        style: {
          display: "grid",
          gridTemplateColumns: "160px 1fr",
          gap: "8px",
          alignItems: "center",
          marginTop: "10px",
        },
      }).appendTo(left);

      function addField(label, control) {
        new UI.Label(label).appendTo(grid);
        grid.el.appendChild(control.el ?? control);
      }

      addField("Name", new UI.TextField("", { placeholder: "Name…" }).bind(store, "name"));

      addField("Role",
        new UI.Select({
          options: [
            { value: "dev", label: "Developer" },
            { value: "ops", label: "Ops" },
            { value: "pm",  label: "Product" },
            { value: "qa",  label: "QA" },
          ],
          placeholder: "Bitte wählen…",
        }).bind(store, "role")
      );

      addField("Age (typed)",
        new UI.Select({
          options: [18, 24, 29, 31, 42, 55],
          parse: (s) => (s === "" ? null : Number(s)),
          format: (v) => (v == null ? "" : String(v)),
          placeholder: "–",
        }).bind(store, "age")
      );

      addField("Active (box)", new UI.Checkbox(false).bind(store, "agree"));
      addField("Zebra (slider)", new UI.Checkbox(false, { slider: true }).bind(store, "config.zebra"));

      // People actions
      const actions = new UI.HDiv({ gap: 8, wrap: true }).appendTo(left).setStyle({ marginTop: "10px" });
      new UI.Button("Add Person", { variant: "secondary" }).appendTo(actions).onClick(() => {
        const s = store.get();
        const maxId = Math.max(0, ...(s.people || []).map(p => p.id));
        const id = maxId + 1;
        const next = { id, name: s.name || `User${id}`, age: Number(s.age ?? 0), active: !!s.agree };
        store.setPath("people", [...(s.people || []), next]);
      });

      new UI.Button("Randomize ages", { variant: "secondary" }).appendTo(actions).onClick(() => {
        const s = store.get();
        const people = (s.people || []).map(p => ({ ...p, age: 18 + Math.floor(Math.random() * 40) }));
        store.setPath("people", people);
      });

      // Live state
      const status = new UI.Text("", { muted: true }).appendTo(right);
      const dump = new UI.Pre("").appendTo(right);
      function renderState() {
        const s = store.get();
        status.setText(`clicks=${s.clicks} | name=${s.name} | role=${s.role} | age=${s.age} | agree=${s.agree}`);
        dump.setText(JSON.stringify(s, null, 2));
      }
      renderState();
      right.own(store.subscribe(() => renderState()));

      return root;
    });

    // -----------------------
    // TAB: Table
    // -----------------------
    tabs.addTab("table", "Table", () => {
      const root = new UI.VDiv({ gap: 12 });

      const top = new UI.HDiv({ gap: 12, wrap: true, align: "center" }).appendTo(root);
      new UI.Heading("People", { level: 3 }).appendTo(top);
      new UI.HSpacer().appendTo(top);

      const zebraInfo = new UI.Text("", { muted: true }).appendTo(top);

      const card = new UI.Card({ title: "Click row → fill form (name/age/active)" }).appendTo(root);

      const table = new UI.TableView({
        columns: [
          { key: "id", label: "ID", align: "right" },
          { key: "name", label: "Name" },
          { key: "age", label: "Age", align: "right" },
          { key: "active", label: "Active", align: "center", format: (v) => (v ? "✓" : "—") },
        ],
        data: [],
        zebra: true,
      }).appendTo(card);

      table.bind(store, "people");

      table.onRowClick((row) => {
        store.setPath("name", row.name);
        store.setPath("age", row.age);
        store.setPath("agree", !!row.active);
      });

      function syncZebra() {
        const on = !!store.get().config?.zebra;
        zebraInfo.setText(`zebra=${on ? "on" : "off"} (toggle in Controls tab)`);
        table.setZebra(on);
      }
      syncZebra();
      root.own(store.subscribe(() => syncZebra()));

      return root;
    });

    // -----------------------
    // TAB: SelectionGroup
    // -----------------------
    tabs.addTab("selection", "Selection", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("SelectionGroup", { level: 3 }).appendTo(root);
      new UI.Text("Keyboard: ← → Home End (roving focus). Change syncs into store.role.", { muted: true }).appendTo(root);

      const card = new UI.Card({ title: "Role" }).appendTo(root);

      const group = new UI.SelectionGroup({ active: store.get().role, wrap: true }).appendTo(card);
      group.addItem("dev", "Developer");
      group.addItem("ops", "Ops");
      group.addItem("pm",  "Product");
      group.addItem("qa",  "QA");

      const out = new UI.Text("", { muted: true }).appendTo(card);

      function sync() {
        const active = group.getActive();
        out.setText(`active=${active}`);
        store.setPath("role", active);
      }
      group.onChange(() => sync());
      sync();

      card.own(store.subscribePath("role", (val) => group.setActive(val)));

      return root;
    });

    // -----------------------
    // TAB: SchemaConfigEditor
    // -----------------------
    tabs.addTab("json", "JSON (User+Expert)", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("SchemaConfigEditor", { level: 3 }).appendTo(root);
      new UI.Text(
        "User UI (json-editor) + Expert view (Ace: value+schema). AJV Draft-07 ist der Gatekeeper. oneOf/anyOf werden in der User UI unterstützt.",
        { muted: true }
      ).appendTo(root);

      const actions = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(root);
      new UI.Button("Load Schema v1", { variant: "secondary" }).appendTo(actions)
        .onClick(() => store.setPath("jsonSchema", schemaV1));

      new UI.Button("Load Schema v2", { variant: "secondary" }).appendTo(actions)
        .onClick(() => store.setPath("jsonSchema", schemaV2));

      new UI.Button("Set backend=http", { variant: "secondary" }).appendTo(actions)
        .onClick(() => {
          const cfg = store.get().jsonConfig || {};
          cfg.backend = { type: "http", url: "http://localhost:8080/api", timeoutMs: 1500, headers: { "x-demo": "1" } };
          store.setPath("jsonConfig", cfg);
        });

      new UI.Button("Set backend=unix", { variant: "secondary" }).appendTo(actions)
        .onClick(() => {
          const cfg = store.get().jsonConfig || {};
          cfg.backend = { type: "unix", path: "/var/run/demo.sock" };
          store.setPath("jsonConfig", cfg);
        });

      new UI.Button("Make invalid (anyOf)", { variant: "secondary" }).appendTo(actions)
        .onClick(() => {
          const cfg = store.get().jsonConfig || {};
          cfg.cache = cfg.cache || {};
          cfg.cache.constraints = {};
          store.setPath("jsonConfig", cfg);
        });

      const editorCard = new UI.Card({ title: "Editor" }).appendTo(root);

      const editor = new UI.SchemaConfigEditor({
        store,
        valuePath: "jsonConfig",
        schemaPath: "jsonSchema",
        title: "Config (User UI + Expert)",
        allowUserWriteback: true,
        userWritebackDebounceMs: 200
      });

      editorCard.add(editor);

      const preview = new UI.Card({ title: "Current config snapshot" }).appendTo(root);
      const out = new UI.Pre("").appendTo(preview);
      function render() { out.setText(JSON.stringify(store.get().jsonConfig, null, 2)); }
      render();
      preview.own(store.subscribePath("jsonConfig", () => render()));

      return root;
    });

    // -----------------------
    // TAB: Charts
    // -----------------------
    tabs.addTab("charts", "Charts", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("Charts", { level: 3 }).appendTo(root);
      new UI.Text("Line: no points, capped 600. Bar + Doughnut from derived state (people).", { muted: true }).appendTo(root);

      const row = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(root);

      const line = new UI.LineChartCard({
        title: "CPU / MEM (Line, no points, max 600)",
        maxPoints: 600,
        height: 280,
        datasets: [
          { label: "cpu", data: [] },
          { label: "mem", data: [] },
        ],
        options: { scales: { y: { suggestedMin: 0, suggestedMax: 100 } } }
      }).appendTo(row).setStyle({ flex: "2 1 520px", minWidth: "320px" });

      const bar = new UI.BarChartCard({
        title: "People by derived role (Bar)",
        height: 280,
      }).appendTo(row).setStyle({ flex: "1 1 320px", minWidth: "280px" });

      const pie = new UI.PieChartCard({
        title: "Same distribution (Doughnut)",
        height: 280,
        doughnut: true,
      }).appendTo(row).setStyle({ flex: "1 1 320px", minWidth: "280px" });

      function mapCountsToChartData(counts) {
        const labels = ["dev", "ops", "pm", "qa"];
        const values = labels.map(k => counts?.[k] ?? 0);
        return { labels, datasets: [{ label: "count", data: values }] };
      }
      bar.bind(store, (s) => mapCountsToChartData(s.metrics?.countsByRole));
      pie.bind(store, (s) => mapCountsToChartData(s.metrics?.countsByRole));

      const controls = new UI.Card({ title: "Line feed controls" }).appendTo(root);
      const ctrlRow = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(controls);
      const feedInfo = new UI.Text("Feeding: off", { muted: true }).appendTo(controls);

      let timer = null;
      function setFeedInfo() {
        feedInfo.setText(timer
          ? "Feeding: 1 sample/sec (pushSample with timestamp) + mirrored to store.metrics.samples"
          : "Feeding: off");
      }

      new UI.Button("Start feed").appendTo(ctrlRow).onClick(() => {
        if (timer) return;
        timer = setInterval(() => {
          const cpu = Math.round(30 + Math.random() * 60);
          const mem = Math.round(20 + Math.random() * 70);
          line.pushSample({ tsMs: Date.now(), values: { cpu, mem } });

          const samples = store.get().metrics?.samples || [];
          samples.push({ tsMs: Date.now(), values: { cpu, mem } });
          while (samples.length > 600) samples.shift();
          store.setPath("metrics.samples", samples);
        }, 1000);
        setFeedInfo();
      });

      new UI.Button("Stop feed", { variant: "secondary" }).appendTo(ctrlRow).onClick(() => {
        if (!timer) return;
        clearInterval(timer);
        timer = null;
        setFeedInfo();
      });

      new UI.Button("Clear line", { variant: "secondary" }).appendTo(ctrlRow).onClick(() => {
        line.setData({ labels: [], datasets: [{ label: "cpu", data: [] }, { label: "mem", data: [] }] });
        store.setPath("metrics.samples", []);
      });

      new UI.Button("Load from bundle", { variant: "secondary" }).appendTo(ctrlRow).onClick(() => {
        const samples = store.get().metrics?.samples || [];
        line.setSamples(samples);
      });

      root.own(() => { if (timer) clearInterval(timer); timer = null; });

      return root;
    });

    // -----------------------
    // TAB: Layout primitives
    // -----------------------
    tabs.addTab("layout", "Layout", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("Layout primitives", { level: 3 }).appendTo(root);
      new UI.Text("HDiv / VDiv / HSpacer / Card / Text / Pre.", { muted: true }).appendTo(root);

      const row = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(root);

      const a = new UI.Card({ title: "Card A" }).appendTo(row).setStyle({ flex: "1 1 260px" });
      a.add(new UI.Text("This card grows and wraps.", { muted: true }));

      const b = new UI.Card({ title: "Card B (wider)" }).appendTo(row).setStyle({ flex: "2 1 360px" });
      b.add(new UI.Text("B is wider (flex 2).", { muted: true }));
      b.add(new UI.Pre("No manual <pre> needed.\nEverything is a BaseElement wrapper.\n"));

      const row2 = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(root);
      new UI.Text("Left").appendTo(row2);
      new UI.HSpacer().appendTo(row2);
      new UI.Text("Right (pushed by HSpacer)").appendTo(row2);

      return root;
    });

    // -----------------------
    // TAB: Lifecycle / Destroy demo
    // -----------------------
    tabs.addTab("lifecycle", "Lifecycle", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("Lifecycle / destroy() demo", { level: 3 }).appendTo(root);
      new UI.Text(
        "Hier wird ein Sub-Tree erstellt und wieder zerstört. Praktisch, um Cleanup (Listener/Intervals) zu testen.",
        { muted: true }
      ).appendTo(root);

      const host = new UI.Card({ title: "Mount area" }).appendTo(root);
      const actions = new UI.HDiv({ gap: 8, wrap: true }).appendTo(root);

      let mounted = null;
      let t = null;

      function mount() {
        if (mounted) return;
        mounted = new UI.VDiv({ gap: 8 });

        mounted.add(new UI.Text("Mounted view: increments local counter each 500ms", { muted: true }));
        const out = new UI.Text("local=0", { className: "mono" });
        mounted.add(out);

        let local = 0;
        t = setInterval(() => {
          local++;
          out.setText(`local=${local}`);
        }, 500);

        mounted.own(() => { if (t) clearInterval(t); t = null; });
        host.add(mounted);
      }

      function unmount() {
        if (!mounted) return;
        mounted.destroy({ remove: true });
        mounted = null;
      }

      new UI.Button("Mount").appendTo(actions).onClick(() => mount());
      new UI.Button("Unmount", { variant: "secondary" }).appendTo(actions).onClick(() => unmount());

      mount();
      root.own(() => unmount());

      return root;
    });

    // Initial apply from <html data-*> (keeps server defaults)
    setTheme(document.documentElement.dataset.uiTheme || "light");
    setDensity(document.documentElement.dataset.uiDensity || "comfortable");

    tabs.setActive("controls");
  </script>
</body>
</html>
