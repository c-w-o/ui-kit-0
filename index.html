<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UI Kit 0 – Demo</title>

  <link rel="stylesheet" href="./src/ui-kit-0.css" />
</head>

<body>
  <div id="app"></div>

  <script type="module">
    import * as UI from "./src/ui-kit-0.js";

    // -----------------------
    // State (Store)
    // -----------------------
    const store = new UI.Store({
      clicks: 0,
      name: "Alice",
      role: "dev",
      age: 31,
      agree: true,
      config: { featureX: false },
      people: [
        { id: 1, name: "Alice", age: 31, active: true },
        { id: 2, name: "Bob", age: 24, active: false },
        { id: 3, name: "Carla", age: 29, active: true },
      ],
    });

    // Root layout
    const app = new UI.VDiv({ gap: 12, className: "app" }).appendTo(document.getElementById("app"));

    // Header
    const header = new UI.Card().appendTo(app).setStyle({ padding: "14px 14px 10px 14px" });
    new UI.Heading("UI Kit 0 – Demo", { level: 2 }).appendTo(header);
    new UI.Text(
      "Widgets demo (ohne chart.js & json-editor.js). Alles ohne innerHTML / manuelle pre/div Labels.",
      { muted: true }
    ).appendTo(header);

    // Main surface
    const surface = new UI.Card().appendTo(app).setStyle({ padding: "14px" });

    // Tabs
    const tabs = new UI.Tabs({ active: "controls" }).appendTo(surface);

    // -----------------------
    // Tab: Controls
    // -----------------------
    tabs.addTab("controls", "Controls", () => {
      const root = new UI.VDiv({ gap: 12 });

      // Two-column layout (responsive via wrap)
      const row = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(root);

      const leftCard = new UI.Card()
        .appendTo(row)
        .setStyle({ padding: "12px", flex: "1 1 320px", minWidth: "280px" });

      const rightCard = new UI.Card()
        .appendTo(row)
        .setStyle({ padding: "12px", flex: "1 1 320px", minWidth: "280px" });

      // Left: Buttons
      new UI.Heading("Buttons", { level: 3 }).appendTo(leftCard);

      const btnRow = new UI.HDiv({ gap: 8, wrap: true }).appendTo(leftCard);

      new UI.Button("Click +1").appendTo(btnRow).onClick(() => {
        store.setPath("clicks", (store.get().clicks || 0) + 1);
      });

      new UI.Button("Reset", { variant: "secondary" }).appendTo(btnRow).onClick(() => {
        store.setPath("clicks", 0);
      });

      new UI.Button("Danger", { variant: "danger" }).appendTo(btnRow).onClick(() => {
        alert("Danger button demo");
      });

      // Left: Form grid (Label + control)
      new UI.Heading("Form", { level: 3 }).appendTo(leftCard);

      const formGrid = new UI.Div({
        className: "ui-formgrid",
        style: {
          display: "grid",
          gridTemplateColumns: "160px 1fr",
          gap: "8px",
          alignItems: "center",
        },
      }).appendTo(leftCard);

      function addField(labelText, controlEl) {
        new UI.Label(labelText).appendTo(formGrid);
        // controlEl can be BaseElement or Node
        formGrid.el.appendChild(controlEl.el ?? controlEl);
      }

      const nameField = new UI.TextField("", { placeholder: "Name…" });
      nameField.bind(store, "name");
      addField("Name", nameField);

      const roleSelect = new UI.Select({
        options: [
          { value: "dev", label: "Developer" },
          { value: "ops", label: "Ops" },
          { value: "pm",  label: "Product" },
        ],
        placeholder: "Bitte wählen…",
      });
      roleSelect.bind(store, "role");
      addField("Role", roleSelect);

      const ageSelect = new UI.Select({
        options: [18, 24, 29, 31, 42, 55],
        parse: (s) => (s === "" ? null : Number(s)),
        format: (v) => (v == null ? "" : String(v)),
        placeholder: "–",
      });
      ageSelect.bind(store, "age");
      addField("Age (typed)", ageSelect);

      const agreeBox = new UI.Checkbox(false);
      agreeBox.bind(store, "agree");
      addField("Active (box)", agreeBox);

      const fx = new UI.Checkbox(false, { slider: true });
      fx.bind(store, "config.featureX");
      addField("Feature X (slider)", fx);

      // Right: Live values (no manual <pre>)
      new UI.Heading("Live state", { level: 3 }).appendTo(rightCard);
      const status = new UI.Text("", { muted: true }).appendTo(rightCard);
      const dump = new UI.Pre("").appendTo(rightCard);

      // Update helpers
      function renderState() {
        const s = store.get();
        status.setText(`clicks=${s.clicks} | name=${s.name} | role=${s.role} | age=${s.age}`);
        dump.setText(JSON.stringify(s, null, 2));
      }
      renderState();
      store.subscribe(() => renderState());

      // Small actions
      const actions = new UI.HDiv({ gap: 8, wrap: true }).appendTo(rightCard);

      new UI.Button("Add Person", { variant: "secondary" })
        .appendTo(actions)
        .onClick(() => {
          const s = store.get();
          const maxId = Math.max(0, ...s.people.map(p => p.id));
          const id = maxId + 1;
          const next = {
            ...s,
            people: [
              ...s.people,
              { id, name: s.name || `User${id}`, age: Number(s.age ?? 0), active: !!s.agree },
            ],
          };
          store.set(next);
        });

      new UI.Button("Toggle Zebra (Table)", { variant: "secondary" })
        .appendTo(actions)
        .onClick(() => {
          // Just flip a flag in state; the Table tab will read it.
          const on = !store.get().config?.zebra;
          store.setPath("config.zebra", on);
        });

      return root;
    });

    // -----------------------
    // Tab: Table
    // -----------------------
    tabs.addTab("table", "Table", () => {
      const root = new UI.VDiv({ gap: 12 });

      const top = new UI.HDiv({ gap: 12, wrap: true, align: "center" }).appendTo(root);
      new UI.Heading("People", { level: 3 }).appendTo(top);

      new UI.HSpacer().appendTo(top);

      const zebraInfo = new UI.Text("", { muted: true }).appendTo(top);

      const tableCard = new UI.Card().appendTo(root).setStyle({ padding: "12px" });

      const table = new UI.TableView({
        columns: [
          { key: "id", label: "ID", align: "right" },
          { key: "name", label: "Name" },
          { key: "age", label: "Age", align: "right" },
          { key: "active", label: "Active", align: "center", format: (v) => (v ? "✓" : "—") },
        ],
        data: [],
        zebra: true,
      }).appendTo(tableCard);

      table.bind(store, "people");

      table.onRowClick((row) => {
        // Example: click selects the name into the form
        store.setPath("name", row.name);
        store.setPath("age", row.age);
        store.setPath("agree", !!row.active);
      });

      function syncZebra() {
        const on = store.get().config?.zebra !== false; // default true
        zebraInfo.setText(`zebra=${on ? "on" : "off"} (toggle in Controls tab)`);
        table.setZebra(on);
      }
      syncZebra();
      store.subscribe(() => syncZebra());

      return root;
    });

    // -----------------------
    // Tab: Selection
    // -----------------------
    tabs.addTab("selection", "Selection", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("SelectionGroup", { level: 3 }).appendTo(root);
      new UI.Text(
        "Button-based selection (keyboard roving focus: ← → Home End).",
        { muted: true }
      ).appendTo(root);

      const card = new UI.Card().appendTo(root).setStyle({ padding: "12px" });

      const group = new UI.SelectionGroup({ active: "dev", wrap: true }).appendTo(card);
      group.addItem("dev", "Developer");
      group.addItem("ops", "Ops");
      group.addItem("pm", "Product");
      group.addItem("qa", "QA");

      const out = new UI.Text("", { muted: true }).appendTo(card);

      function sync() {
        const active = group.getActive();
        out.setText(`active=${active}`);
        store.setPath("role", active);
      }
      group.onChange(() => sync());
      sync();

      return root;
    });

    // -----------------------
    // Tab: Layout (HDiv/VDiv/Spacers/Card/Text)
    // -----------------------
    tabs.addTab("layout", "Layout", () => {
      const root = new UI.VDiv({ gap: 12 });

      new UI.Heading("Layout primitives", { level: 3 }).appendTo(root);
      new UI.Text("HDiv / VDiv / HSpacer / Card / Text blocks.", { muted: true }).appendTo(root);

      const row = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(root);

      const a = new UI.Card().appendTo(row).setStyle({ padding: "12px", flex: "1 1 260px" });
      new UI.Heading("Card A", { level: 4 }).appendTo(a);
      new UI.Text("This card grows and wraps.", { muted: true }).appendTo(a);

      const b = new UI.Card().appendTo(row).setStyle({ padding: "12px", flex: "2 1 360px" });
      new UI.Heading("Card B", { level: 4 }).appendTo(b);
      new UI.Text("B is wider (flex 2).", { muted: true }).appendTo(b);

      const row2 = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(root);
      new UI.Text("Left").appendTo(row2);
      new UI.HSpacer().appendTo(row2);
      new UI.Text("Right (pushed by HSpacer)").appendTo(row2);

      return root;
    });

    // Default tab
    tabs.setActive("controls");
  </script>
</body>
</html>