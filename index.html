<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>UI Kit 0</title>

  <link rel="stylesheet" href="./src/ui-kit-0.css" />

  <!-- third_party: offline libs (optional) -->
  <!-- Wenn du Ajv/Chart nutzen willst, Dateien hier ablegen und diese Zeilen aktiv lassen-->
  <!--   <script src="./third_party/chart.umd.js"></script-->
   <!--  <script src="./third_party/ajv2020.js"></script> -->

  <style>
    h1 { margin: 0 0 8px 0; font-size: 20px; }
    .muted { opacity: 0.75; }
    pre { background: #f6f7f9; padding: 12px; border-radius: 8px; overflow: auto; }

    /* kleine Demo-Layout-Hilfe */
    .grow { flex: 1 1 420px; }
  </style>
</head>

<body>
<script type="module">
  import * as UI from "./src/ui-kit-0.js";

  const app = new UI.VGrid().appendTo(document.body);

  const header = document.createElement("div");
  header.innerHTML = `
    <h1>UI Kit 0 – Demo</h1>
    <div class="muted">
      Module + CSS laufen. third_party optional: Chart/Ajv werden nur genutzt, wenn geladen.
    </div>
  `;
  app.el.appendChild(header);

  const row = new UI.HGrid().appendTo(app);
  row.el.classList.add("grow");

  const left = new UI.Card().appendTo(row);
  left.el.classList.add("grow");

  const mid = new UI.Card().appendTo(row);
  mid.el.classList.add("grow");

  const right = new UI.Card().appendTo(row);
  right.el.classList.add("grow");

  // -----------------------
  // State
  // -----------------------
  const state = {
    clicks: 0,
    name: "",
    agree: false,
    people: [
      { id: 1, name: "Alice", age: 31, active: true },
      { id: 2, name: "Bob", age: 24, active: false },
      { id: 3, name: "Carla", age: 29, active: true }
    ]
  };

  // -----------------------
  // Left: Controls
  // -----------------------
  left.el.innerHTML = `<div style="font-weight:600; margin-bottom:8px;">Controls</div>`;

  const btnRow = new UI.HGrid().appendTo(left);

  new UI.Button("Click +1")
    .appendTo(btnRow)
    .onClick(() => { state.clicks += 1; render(); });

  new UI.Button("Add Person")
    .appendTo(btnRow)
    .onClick(() => {
      const id = Math.max(...state.people.map(p => p.id)) + 1;
      state.people.push({ id, name: state.name || `User${id}`, age: Math.max(0, state.clicks), active: state.agree });
      render();
    });

  const form = document.createElement("div");
  form.style.display = "grid";
  form.style.gridTemplateColumns = "160px 1fr";
  form.style.gap = "8px";
  form.style.alignItems = "center";
  form.style.marginTop = "12px";
  left.el.appendChild(form);

  // Name
  form.appendChild(Object.assign(document.createElement("div"), { textContent: "Name" }));
  const nameField = new UI.TextField("").appendTo(form);
  nameField.on("input", () => { state.name = nameField.getValue(); render(); });

  // Agree
  form.appendChild(Object.assign(document.createElement("div"), { textContent: "Active" }));
  const agreeWrap = document.createElement("div");
  form.appendChild(agreeWrap);
  const agreeBox = new UI.Checkbox(false).appendTo(agreeWrap);
  agreeBox.on("change", () => { state.agree = agreeBox.getValue(); render(); });

  // -----------------------
  // Mid: Table
  // -----------------------
  mid.el.innerHTML = `<div style="font-weight:600; margin-bottom:8px;">Table</div>`;

  const table = new UI.TableView({
    columns: [
      { key: "id", label: "ID", align: "right" },
      { key: "name", label: "Name" },
      { key: "age", label: "Age", align: "right" },
      { key: "active", label: "Active", format: (v) => v ? "✓" : "—", align: "center" }
    ],
    data: state.people
  }).appendTo(mid);

  // optional: row click
  table.onRowClick((row) => {
    console.log("row clicked:", row);
  });

  // -----------------------
  // Right: Debug + optional Chart/Ajv status
  // -----------------------
  right.el.innerHTML = `<div style="font-weight:600; margin-bottom:8px;">Debug</div>`;

  const status = document.createElement("div");
  status.className = "muted";
  right.el.appendChild(status);

  const pre = document.createElement("pre");
  right.el.appendChild(pre);

  // Optional Chart (only if loaded)
  let chart = null;
  const chartHost = document.createElement("div");
  chartHost.style.marginTop = "12px";
  right.el.appendChild(chartHost);

  function ensureChart() {
    if (chart) return chart;
    if (!window.Chart) return null;

    const card = document.createElement("div");
    card.style.marginTop = "12px";
    chartHost.appendChild(card);

    chart = new UI.ChartView({
      type: "bar",
      data: { labels: ["Clicks"], datasets: [{ label: "clicks", data: [state.clicks] }] }
    }).appendTo(card);

    return chart;
  }

  function render() {
    // status
    const hasChart = !!window.Chart;
    const hasAjv = !!window.Ajv2020;
    status.textContent = `Chart: ${hasChart ? "OK" : "off"} | Ajv: ${hasAjv ? "OK" : "off"}`;

    // debug json
    pre.textContent = JSON.stringify(state, null, 2);

    // table refresh
    table.setData(state.people);

    // chart refresh (if available)
    const c = ensureChart();
    if (c) {
      c.setData({ labels: ["Clicks"], datasets: [{ label: state.name || "clicks", data: [state.clicks] }] });
    }
  }

  render();
</script>
</body>
</html>