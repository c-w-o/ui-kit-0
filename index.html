<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UI Kit 0 – Widgets Demo (no chart/json-editor)</title>

  <link rel="stylesheet" href="./src/ui-kit-0.css" />

  <!-- Optional (offline/local): Ajv2020 UMD -> window.ajv2020 (per your third_party file) -->
  <script src="./src/third_party/ajv2020.js"></script>
</head>

<body>
<script type="module">
  import * as UI from "./src/ui-kit-0.js";

  // ------------------------------------------------------------
  // Store
  // ------------------------------------------------------------
  const store = new UI.Store({
    clicks: 0,
    name: "Alice",
    role: "dev",
    age: 31,
    agree: true,
    config: { featureX: false },
    people: [
      { id: 1, name: "Alice", age: 31, active: true },
      { id: 2, name: "Bob",   age: 24, active: false },
      { id: 3, name: "Carla", age: 29, active: true },
    ],
    ui: {
      zebra: true,
      activePanel: "controls",
    }
  });

  // ------------------------------------------------------------
  // App root layout
  // ------------------------------------------------------------
  const app = new UI.VDiv({ gap: 12, className: "app" }).appendTo(document.body);

  new UI.Heading("UI Kit 0 – Widgets Demo", { level: 1 }).appendTo(app);

  new UI.Text(
    `Showing: layout, spacers, controls, store-bindings, selection, tabs, table. ` +
    `Ajv loaded: ${String(!!(window.ajv2020 || window.Ajv2020))}. ` +
    `(No Chart, no JSON editor on purpose.)`,
    { muted: true }
  ).appendTo(app);

  // Main row: left (tabs), right (debug)
  const main = new UI.HDiv({ gap: 12, wrap: true, align: "stretch" }).appendTo(app);

  const leftCard  = new UI.Card().appendTo(main);
  const rightCard = new UI.Card().appendTo(main);

  leftCard.setStyle({ flex: "2 1 560px" }).setTitle("Demo Tabs");
  rightCard.setStyle({ flex: "1 1 360px" }).setTitle("Debug");

  // ------------------------------------------------------------
  // Debug panel (right)
  // ------------------------------------------------------------

  const debug = new UI.VDiv({ gap: 8 }).appendTo(rightCard);

  const debugRow = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(debug);

  // Small layout demo: spacer pushes buttons to the right
  new UI.Div({ className: "muted" }).setText("Spacer demo:").appendTo(debugRow);
  new UI.HSpacer().appendTo(debugRow);
  new UI.Button("Ping", { variant: "secondary" }).appendTo(debugRow).onClick(() => {
    console.log("ping", new Date().toISOString());
  });

  const pre = new UI.Pre("").appendTo(debug);
  store.subscribe(() => pre.setText(JSON.stringify(store.get(), null, 2)));
  pre.setText(JSON.stringify(store.get(), null, 2));

  // Keep debug updated
  store.subscribe(() => {
    pre.textContent = JSON.stringify(store.get(), null, 2);
  });
  pre.textContent = JSON.stringify(store.get(), null, 2);

  // ------------------------------------------------------------
  // Tabs (left)
  // ------------------------------------------------------------

  const tabs = new UI.Tabs({ active: store.get().ui.activePanel }).appendTo(leftCard);
  tabs.onChange((id) => store.setPath("ui.activePanel", id));

  // ------------------------------------------------------------
  // Tab 1: Controls + bindings
  // ------------------------------------------------------------
  tabs.addTab("controls", "Controls", () => {
    const root = new UI.VDiv({ gap: 12 }).appendTo(document.createElement("div"));

    // Button row
    const btnRow = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(root);

    new UI.Button("Click +1").appendTo(btnRow).onClick(() => {
      store.setPath("clicks", (store.get().clicks || 0) + 1);
    });

    new UI.Button("Reset", { variant: "secondary" }).appendTo(btnRow).onClick(() => {
      store.merge({ clicks: 0 });
    });

    new UI.Button("Danger", { variant: "danger" }).appendTo(btnRow).onClick(() => {
      alert("Danger button demo");
    });

    // Form-like grid: labels + inputs
    const form = new UI.Div({ className: "field", style: { marginTop: "4px" } }).appendTo(root);

    // Helper: label
    const addLabel = (text) => {
      const l = document.createElement("div");
      l.className = "ui-label";
      l.textContent = text;
      form.el.appendChild(l);
    };

    // Name
    addLabel("Name");
    const nameField = new UI.TextField("", { placeholder: "Name…" }).appendTo(form);
    nameField.bind(store, "name");

    // Role (Select)
    addLabel("Role");
    const roleSelect = new UI.Select({
      options: [
        { value: "dev", label: "Developer" },
        { value: "ops", label: "Ops" },
        { value: "pm",  label: "Product" },
      ],
      placeholder: "Bitte wählen…",
    }).appendTo(form);
    roleSelect.bind(store, "role");

    // Age (typed Select demo)
    addLabel("Age (typed)");
    const ageSelect = new UI.Select({
      options: [18, 24, 29, 31, 42, 55],
      parse: (s) => (s === "" ? null : Number(s)),
      format: (v) => (v == null ? "" : String(v)),
      placeholder: "–",
    }).appendTo(form);
    ageSelect.bind(store, "age");

    // Checkbox normal
    addLabel("Agree (box)");
    const agreeBox = new UI.Checkbox(false).appendTo(form);
    agreeBox.bind(store, "agree");

    // Checkbox slider
    addLabel("Feature X (slider)");
    const fx = new UI.Checkbox(false, { slider: true }).appendTo(form);
    fx.bind(store, "config.featureX");

    // Small live readout row
    const info = new UI.Div({ className: "muted" }).appendTo(root);
    store.subscribe(() => {
      const s = store.get();
      info.setText(`clicks=${s.clicks} | name=${s.name} | role=${s.role} | age=${s.age} | agree=${s.agree} | featureX=${s.config.featureX}`);
    });
    info.setText(`clicks=${store.get().clicks} | name=${store.get().name} | role=${store.get().role} | age=${store.get().age} | agree=${store.get().agree} | featureX=${store.get().config.featureX}`);

    return root;
  });

  // ------------------------------------------------------------
  // Tab 2: TableView + zebra toggle + row click
  // ------------------------------------------------------------
  tabs.addTab("table", "Table", () => {
    const root = new UI.VDiv({ gap: 12 }).appendTo(document.createElement("div"));

    const bar = new UI.HDiv({ gap: 8, wrap: true, align: "center" }).appendTo(root);

    const zebraToggle = new UI.Checkbox(store.get().ui.zebra, { slider: true }).appendTo(bar);
    zebraToggle.on("change", () => store.setPath("ui.zebra", zebraToggle.getValue()));

    new UI.Div({ className: "muted" }).setText("Zebra rows").appendTo(bar);

    new UI.HSpacer().appendTo(bar);

    new UI.Button("Add random").appendTo(bar).onClick(() => {
      const p = store.get().people;
      const nextId = (Math.max(0, ...p.map(x => x.id)) + 1);
      const names = ["Dana", "Eli", "Fay", "Gus", "Hana", "Ivo"];
      const name = names[Math.floor(Math.random() * names.length)] + nextId;
      p.push({ id: nextId, name, age: 18 + Math.floor(Math.random() * 50), active: Math.random() > 0.4 });
      store.setPath("people", p);
    });

    const table = new UI.TableView({
      columns: [
        { key: "id",     label: "ID",     align: "right" },
        { key: "name",   label: "Name" },
        { key: "age",    label: "Age",    align: "right" },
        { key: "active", label: "Active", align: "center", format: (v) => v ? "✓" : "—" },
      ],
      data: store.get().people,
      zebra: store.get().ui.zebra,
    }).appendTo(root);

    table.onRowClick((row) => {
      alert(`Row click:\n${JSON.stringify(row, null, 2)}`);
    });

    // Bind table data
    table.bind(store, "people");

    // Bind zebra flag
    store.subscribePath("ui.zebra", (val) => table.setZebra(!!val));

    return root;
  });

  // ------------------------------------------------------------
  // Tab 3: SelectionGroup demo
  // ------------------------------------------------------------
  tabs.addTab("selection", "Selection", () => {
    const root = new UI.VDiv({ gap: 12 }).appendTo(document.createElement("div"));

    const group = new UI.SelectionGroup({ active: "a", wrap: true }).appendTo(root);
    group.addItem("a", "Option A");
    group.addItem("b", "Option B");
    group.addItem("c", "Option C");
    group.addItem("d", "Option D");

    const out = new UI.Div({ className: "muted" }).appendTo(root);
    out.setText(`Active: ${group.getActive()}`);

    group.onChange((id) => {
      out.setText(`Active: ${id}`);
    });

    const hint = new UI.Div({ className: "muted" }).appendTo(root);
    hint.setText("Keyboard: ArrowLeft/ArrowRight, Home/End, Enter/Space.");

    return root;
  });

  // ------------------------------------------------------------
  // Tab 4: Layout widgets (Div/HDiv/VDiv + spacers)
  // ------------------------------------------------------------
  tabs.addTab("layout", "Layout", () => {
    const root = new UI.VDiv({ gap: 12 }).appendTo(document.createElement("div"));

    new UI.Div({ className: "muted" })
      .setText("HDiv with HSpacer pushes the right block to the edge:")
      .appendTo(root);

    const top = new UI.HDiv({ gap: 8, wrap: false, align: "center" }).appendTo(root);
    new UI.Div().setText("Left").appendTo(top);
    new UI.HSpacer().appendTo(top);
    new UI.Div().setText("Right").appendTo(top);

    new UI.Div({ className: "muted" })
      .setText("VDiv stacks; VSpacer can consume remaining space if container has fixed height:")
      .appendTo(root);

    const box = new UI.VDiv({
      gap: 8,
      className: "card",
      style: { height: "180px", padding: "12px" }
    }).appendTo(root);

    new UI.Div().setText("Top").appendTo(box);
    new UI.VSpacer().appendTo(box);
    new UI.Div().setText("Bottom").appendTo(box);

    return root;
  });

  // Set initial active panel based on store
  tabs.setActive(store.get().ui.activePanel);

</script>
</body>
</html>